<!doctype html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Text Fill Progress — GOAL</title>
  <style>
    :root {
      --width: min(920px, 92vw);
      --bg: #071025;
      --text-size: clamp(48px, 12vw, 160px);
      --inactive: #243349;
      /* 消灯（背景文字色）*/
      --active: #06b6d4;
      /* 埋まる色 */
      --outline: rgba(255, 255, 255, 0.06);
    }

    html,
    body {
      height: 100%;
      margin: 0;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Hiragino Kaku Gothic ProN', 'Yu Gothic', Meiryo, sans-serif;
      background: var(--bg);
      color: #e6eef8
    }

    .wrap {
      max-width: var(--width);
      margin: 40px auto;
      padding: 20px;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
      border-radius: 14px;
      border: 1px solid var(--outline);
      box-shadow: 0 12px 36px rgba(0, 0, 0, .6)
    }

    .preview {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 28px;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.01), transparent);
      border-radius: 10px
    }

    /* SVG Text を中心に配置 */
    svg#textSvg {
      width: 100%;
      height: calc(var(--text-size) * 1.05);
      display: block
    }

    /* controls */
    .controls {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
      margin-top: 14px
    }

    input[type=range] {
      width: 360px
    }

    input[type=text] {
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #163445;
      background: #071428;
      color: #e6eef8
    }

    .btn {
      background: #072842;
      border: 1px solid #114a66;
      color: #dff7fb;
      padding: 8px 12px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700
    }

    label {
      font-size: 13px;
      color: #9fb0c2
    }

    .small {
      font-size: 12px;
      color: #8ea3b8
    }

    /* スムーズな埋まりアニメーション */
    .filler-rect {
      transition: width .35s cubic-bezier(.2, .9, .3, 1)
    }

    /* 文字の輪郭をより見せる */
    .strokeText {
      fill: none;
      stroke: rgba(255, 255, 255, 0.06);
      stroke-width: 1
    }

    /* アクセシビリティのための非表示テキスト */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0
    }
  </style>
</head>

<body>
  <div class="wrap">
    「文字の背景色が埋まっていくことで進捗を表現することもできますか？例えばGOALの文字を使って。 HTMLファイルとして出力してほしいです。」
    という依頼でGhat GPT5に作ってもらったHTML
  </div>
  <div class="wrap">
    <h1 style="margin:0 0 8px 0;font-size:18px">文字の背景が埋まっていく進捗表示 — GOAL</h1>
    <p class="small" style="margin:0 0 12px 0">SVGマスクを使って、文字（デフォルト：<strong>GOAL</strong>）の内部に左から色が塗り進む表現です。スライダー・デモ付き。
    </p>

    <div class="preview" role="img" aria-label="GOAL progress preview">
      <!-- SVG: inactive文字を下地にして、その上にクリップされたカラー文字を重ねる -->
      <svg id="textSvg" viewBox="0 0 1200 240" preserveAspectRatio="xMidYMid meet" aria-hidden="false">
        <defs>
          <!-- 文字領域をマスクにするための text を定義 -->
          <mask id="text-mask">
            <!-- 白＝表示、黒＝非表示。ここでは文字を白で描画してマスクにする -->
            <rect x="0" y="0" width="1200" height="240" fill="black"></rect>
            <text id="maskText" x="50%" y="50%" dominant-baseline="middle" text-anchor="middle"
              font-family="Inter, Roboto, 'Hiragino Kaku Gothic ProN', 'Yu Gothic', Meiryo, sans-serif"
              font-weight="800" font-size="160" fill="white">GOAL</text>
          </mask>

          <!-- クリップ用に同じテキストでパスを作っておく（視覚的輪郭） -->
        </defs>

        <!-- 背景文字（消灯色） -->
        <text id="bgText" x="50%" y="50%" dominant-baseline="middle" text-anchor="middle"
          font-family="Inter, Roboto, 'Hiragino Kaku Gothic ProN', 'Yu Gothic', Meiryo, sans-serif" font-weight="800"
          font-size="160" fill="var(--inactive)">GOAL</text>

        <!-- 塗り進む長方形をマスクとして使い、文字内部だけが active 色で見えるようにする -->
        <g mask="url(#text-mask)">
          <rect id="filler" class="filler-rect" x="0" y="0" width="0" height="240" fill="var(--active)"></rect>
        </g>

        <!-- 輪郭線（微かに） -->
        <text class="strokeText" x="50%" y="50%" dominant-baseline="middle" text-anchor="middle"
          font-family="Inter, Roboto, 'Hiragino Kaku Gothic ProN', 'Yu Gothic', Meiryo, sans-serif" font-weight="800"
          font-size="160">GOAL</text>
      </svg>
    </div>

    <div class="controls">
      <label>テキスト: <input id="textInput" type="text" value="GOAL" maxlength="12" /></label>
      <label>進捗: <input id="range" type="range" min="0" max="100" value="0" step="1" /></label>
      <div style="display:flex;gap:8px;align-items:center">
        <button id="demo" class="btn">デモ</button>
        <button id="reset" class="btn">リセット</button>
      </div>
      <div style="margin-left:auto" class="small">左から右に塗り進みます。APIで setTextFillProgress(p) を呼べます。</div>
    </div>

    <p class="small" style="margin-top:10px">※ SVGはレスポンシブです。フォントサイズは画面幅に応じて変わります。</p>

    <p class="sr-only" id="ariaProgress">進捗 0 パーセント</p>
  </div>

  <script>
    const svg = document.getElementById('textSvg');
    const filler = document.getElementById('filler');
    const range = document.getElementById('range');
    const textInput = document.getElementById('textInput');
    const maskText = document.getElementById('maskText');
    const bgText = document.getElementById('bgText');
    const ariaProgress = document.getElementById('ariaProgress');
    const demoBtn = document.getElementById('demo');
    const resetBtn = document.getElementById('reset');

    // viewBox サイズに依存するため、SVGの幅（1200）を基準に計算している
    const SVG_WIDTH = 1200;
    const SVG_HEIGHT = 240;

    function setProgress(pct) {
      const p = Math.max(0, Math.min(100, Math.round(pct)));
      const bbox = maskText.getBBox(); // 文字の矩形を取得
      const x = bbox.x;
      const w = bbox.width * (p / 100);

      filler.setAttribute('x', String(x));
      filler.setAttribute('width', String(w));

      svg.setAttribute('aria-valuenow', String(p));
      ariaProgress.textContent = `進捗 ${p} パーセント`;
      range.value = String(p);
    }


    // テキスト変更を反映
    function setText(str) {
      const safe = String(str || '').slice(0, 12) || 'GOAL';
      maskText.textContent = safe;
      bgText.textContent = safe;
    }

    // 初期
    setText('GOAL');
    setProgress(0);

    // イベント
    range.addEventListener('input', (e) => setProgress(parseInt(e.target.value, 10)));
    textInput.addEventListener('change', (e) => setText(e.target.value));

    // デモ
    let anim = null;
    demoBtn.addEventListener('click', () => {
      if (anim) { cancelAnimationFrame(anim); anim = null; demoBtn.textContent = 'デモ'; return; }
      demoBtn.textContent = '停止';
      const start = performance.now();
      const duration = 2400; // ms
      function ease(t) { return t < .5 ? 2 * t * t : 1 - Math.pow(-2 * t + 2, 2) / 2; }
      function frame(now) {
        const t = Math.min(1, (now - start) / duration);
        const v = Math.round(ease(t) * 100);
        setProgress(v);
        if (t < 1) anim = requestAnimationFrame(frame); else { anim = null; demoBtn.textContent = 'デモ'; }
      }
      anim = requestAnimationFrame(frame);
    });

    resetBtn.addEventListener('click', () => { if (anim) { cancelAnimationFrame(anim); anim = null; demoBtn.textContent = 'デモ'; } setText('GOAL'); setProgress(0); });

    // 外部API
    window.setTextFillProgress = (p) => setProgress(p);
    window.setTextFill = (str) => setText(str);

    // ウィンドウリサイズで SVG 内のテキスト位置がずれることがあるため、フォントレンダリングの反映を強制する
    window.addEventListener('resize', () => { /* no-op but kept in case of future scaling logic */ });

  </script>
</body>

</html>